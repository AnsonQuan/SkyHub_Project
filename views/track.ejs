<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Track a Flight | SkyHub</title>
  <link rel="stylesheet" href="/stylesheets/track.css">
</head>
<body>
<%- include partials/header.ejs %>
<%- include partials/navbar.ejs %>
<body>
    <h1>Flight Search</h1>
    <form id="flightSearchForm">
        <label for="departureCity">Departure City:</label>
        <input type="text" id="departureCity" name="departureCity" required>
        <br>
        <label for="destinationCity">Destination City:</label>
        <input type="text" id="destinationCity" name="destinationCity" required>
        <br>
        <label for="departureDate">Departure Date:</label>
        <input type="date" id="departureDate" name="departureDate" required>
        <br>
        <button type="submit">Search Flights</button>
    </form>

    <div id="flightResults"></div>

    <script>
        document.getElementById("flightSearchForm").addEventListener("submit", function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            const searchParams = new URLSearchParams(formData).toString();

            fetch(`/flight-search?${searchParams}`)
                .then(response => response.json())
                .then(data => {
                    const flightResultsDiv = document.getElementById("flightResults");
                    flightResultsDiv.innerHTML = ""; // Clear previous results

                    data.forEach(flight => {
                        const flightInfo = `<div>
                            <p>Departure Date: ${flight.departureDate}</p>
                            <p>Return Date: ${flight.returnDate}</p>
                            <p>Price: ${flight.price.currencyCode} ${flight.price.units}.${flight.price.nanos}</p>
                        </div>`;
                        flightResultsDiv.insertAdjacentHTML("beforeend", flightInfo);
                    });
                })
                .catch(error => {
                    console.error("Error fetching flight data:", error);
                });
        });
    </script>
</body>
<%- include partials/footer.ejs %>
